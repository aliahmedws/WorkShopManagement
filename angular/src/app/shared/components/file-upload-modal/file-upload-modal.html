<!-- Trigger button (inside component) -->
<button
  type="button"
  [class]="buttonClass"
  [disabled]="disabled"
  (click)="open()"
  [title]="buttonTitle"
>
  <i [class]="buttonIcon" aria-hidden="true"></i>
</button>

<!-- Modal -->
<abp-modal [(visible)]="visible" [options]="{ size: modalSize }">
  <ng-template #abpHeader>
    <div class="fw-bold">{{ title }}</div>
  </ng-template>

  <ng-template #abpBody>
    <div
      class="upload-dropzone"
      [class.dragging]="dragging"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
      (click)="triggerBrowse(fileInput)"
      role="button"
      tabindex="0"
    >
      <div class="upload-icon">
        <i class="fa fa-cloud-upload-alt"></i>
      </div>

      <div class="upload-text">
        <div class="fw-semibold">
          Click to browse <span class="text-muted fw-normal">or drag and drop</span>
        </div>
        <div class="text-muted small">
          {{ acceptedTypes.join(', ') }} (Max {{ maxSizeMB }}MB)
        </div>
      </div>

      <input
        #fileInput
        type="file"
        class="d-none"
        [multiple]="multiple"
        [accept]="acceptedTypes.join(',')"
        (change)="onFilePicked($event)"
      />
    </div>

    <div class="text-danger small mt-2" *ngIf="error">
      {{ error }}
    </div>

    <!-- NEW uploads -->
    <div class="mt-3" *ngIf="(tempFiles?.length ?? 0) > 0">
      <div class="fw-semibold mb-2">New uploads</div>

      <div class="d-flex flex-wrap gap-3">
        <div class="position-relative" *ngFor="let item of tempFiles; let i = index">
          <img
            *ngIf="isImage(item.name)"
            nz-image
            [nzSrc]="item.path"
            class="border rounded"
            style="width: 100px; height: 100px; object-fit: cover; cursor: zoom-in;"
            [title]="item.name"
          />

          <div
            *ngIf="!isImage(item.name)"
            class="border rounded bg-light d-flex flex-column align-items-center justify-content-center"
            style="width: 100px; height: 100px;"
            [title]="item.name"
          >
            <i class="fa fa-file-lines fa-2x text-secondary mb-1"></i>
            <small class="text-truncate w-75 text-center" style="font-size: 10px;">
              {{ item.name }}
            </small>
          </div>

          <button
            type="button"
            class="btn btn-danger btn-sm position-absolute top-0 start-100 translate-middle rounded-circle p-0 d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px;"
            (click)="onRemoveTemp(i)"
            title="Remove"
          >
            <i class="fa fa-times" style="font-size: 12px;"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- EXISTING attachments -->
    <div class="mt-3" *ngIf="(existingFiles?.length ?? 0) > 0">
      <div class="fw-semibold mb-2">Existing attachments</div>

      <div class="d-flex flex-wrap gap-3">
        <div class="position-relative" *ngFor="let item of existingFiles; let i = index">
          <img
            *ngIf="isImage(item.attachment?.name)"
            nz-image
            [nzSrc]="item.attachment?.path"
            class="border rounded"
            style="width: 100px; height: 100px; object-fit: cover; cursor: zoom-in;"
            [title]="item.attachment?.name"
          />

          <div
            *ngIf="!isImage(item.attachment?.name)"
            class="border rounded bg-light d-flex flex-column align-items-center justify-content-center"
            style="width: 100px; height: 100px;"
            [title]="item.attachment?.name"
          >
            <i class="fa fa-file-lines fa-2x text-secondary mb-1"></i>
            <small class="text-truncate w-75 text-center" style="font-size: 10px;">
              {{ item.attachment?.name }}
            </small>
          </div>

          <button
            type="button"
            class="btn btn-danger btn-sm position-absolute top-0 start-100 translate-middle rounded-circle p-0 d-flex align-items-center justify-content-center"
            style="width: 20px; height: 20px;"
            (click)="onRemoveExisting(i)"
            title="Remove"
          >
            <i class="fa fa-times" style="font-size: 12px;"></i>
          </button>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #abpFooter>
    <div class="d-flex justify-content-end gap-2">
      <button type="button" class="btn btn-outline-secondary" (click)="close()">
        Close
      </button>
    </div>
  </ng-template>
</abp-modal>
