<div class="file-upload-container" [class.app-upload-sm]="size === 'small'">
    <div class="upload-area" [class.dragging]="isDragging" (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" (click)="fileInput.click()">

        <i class="upload-icon fas fa-cloud-upload"></i>
        <p class="upload-text">
            <span class="highlight">Click to browse</span> or drag and drop
        </p>
        <p class="upload-hint">{{ acceptedTypes.join(', ') }} (Max {{ maxSizeMB }}MB)</p>

        <input #fileInput type="file" [multiple]="multiple" [accept]="acceptedTypes.join(',')"
            (change)="onFileSelect($event)" style="display: none">
    </div>

    @if (error) {
    <div class="error-message">{{ error }}</div>
    }

    <!-- Temp uploads (newly uploaded, not yet persisted) -->
    @if ((tempFiles?.length ?? 0) > 0) {
    <div class="mt-3">
        <div class="fw-semibold mb-2">New uploads</div>

        <div class="d-flex flex-wrap gap-3">
            @for (item of tempFiles; track item.blobName; let i = $index) {
            <div class="position-relative">
                <img *ngIf="isImage(item.name)" nz-image [appSignedNzSrc]="item.path"
                    class="border rounded"
                    style="width: 100px; height: 100px; object-fit: cover; cursor: zoom-in;" [title]="item.name" />
                <a *ngIf="!isImage(item.name)"
                    [appSignedHref]="item.path"
                    [signedHrefFileName]="item.name"
                    class="border rounded bg-light d-flex flex-column align-items-center justify-content-center"
                    style="width: 100px; height: 100px;" [title]="item.name">
                    <i class="fa fa-file-lines fa-2x text-secondary mb-1"></i>
                    <small class="text-truncate w-75 text-center text-secondary" style="font-size: 10px;">
                        {{ item.name }}
                    </small>
                </a>

                <button type="button"
                    class="btn btn-danger btn-sm position-absolute top-0 start-100 translate-middle rounded-circle p-0 d-flex align-items-center justify-content-center"
                    style="width: 20px; height: 20px;" (click)="onRemoveTemp(i)" title="Remove temp file">
                    <i class="fa fa-times" style="font-size: 12px;"></i>
                </button>
            </div>
            }
        </div>
    </div>
    }

    <!-- Existing attachments (already saved) -->
    @if ((existingFiles?.length ?? 0) > 0) {
    <div class="mt-3">
        <div class="fw-semibold mb-2">Existing attachments</div>

        <div class="d-flex flex-wrap gap-3">
            @for (item of existingFiles; track item.id; let i = $index) {
            <div class="position-relative">
                <img *ngIf="isImage(item.attachment.name)" nz-image [appSignedNzSrc]="item.attachment.path"
                    class="border rounded" style="width: 100px; height: 100px; object-fit: cover; cursor: zoom-in;"
                    [title]="item.attachment.name" />

                <a *ngIf="!isImage(item.attachment.name)"
                    [appSignedHref]="item.attachment.path"
                    [signedHrefFileName]="item.attachment.name"
                    class="border rounded bg-light d-flex flex-column align-items-center justify-content-center"
                    style="width: 100px; height: 100px;" [title]="item.attachment.name">
                    <i class="fa fa-file-lines fa-2x text-secondary mb-1"></i>
                    <small class="text-truncate w-75 text-center text-secondary" style="font-size: 10px;">
                        {{ item.attachment.name }}
                    </small>
                </a>

                <button type="button"
                    class="btn btn-danger btn-sm position-absolute top-0 start-100 translate-middle rounded-circle p-0 d-flex align-items-center justify-content-center"
                    style="width: 20px; height: 20px;" (click)="onRemoveExisting(i)" title="Remove existing attachment">
                    <i class="fa fa-times" style="font-size: 12px;"></i>
                </button>
            </div>
            }
        </div>
    </div>
    }
</div>