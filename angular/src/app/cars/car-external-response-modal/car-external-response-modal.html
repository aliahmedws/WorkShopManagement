<abp-modal [(visible)]="visible" [options]="modalOptions" (visibleChange)="visibleChange.emit($event)">
    <ng-template #abpHeader>
        <div class="d-flex align-items-center justify-content-between w-100">
            <div class="d-flex flex-column">
                <div class="modal-title-line">
                    <h1 class="fw-bold">
                        {{ vinNo || '-' }}
                        <span class="text-muted ms-2">
                            {{ '::ExternalApiResponse' | abpLocalization }}
                        </span>
                    </h1>
                </div>
            </div>
        </div>
    </ng-template>

    <ng-template #abpBody>
        @if(loading) {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">...</span>
            </div>
            <p class="mt-2 text-muted">{{ '::Loading' | abpLocalization }}...</p>
        </div>
        }

        @if(!loading && !specs){
        <div class="alert alert-warning" role="alert">
            {{ '::NoExternalDataFound' | abpLocalization }}
        </div>
        }

        @if(!loading && specs && !specs.success){
        <div class="alert alert-danger" role="alert">
            {{ '::ExternalApiResponseFailed' | abpLocalization }}
        </div>
        <div class="p-2">
            <p class="text-danger mb-0">{{ specs.error || 'Unknown error' }}</p>
        </div>
        }

        @if(!loading && specs?.success){
        <table class="table table-bordered">
            <tbody>
                @for (item of displayItems; track $index) {

                @if (item.isHeader) {
                <tr class="bg-secondary header">
                    <td colspan="4">
                        <h6 class="m-0 fw-bold text-white text-uppercase small ls-1">
                            {{ item.value }}
                        </h6>
                    </td>
                </tr>
                }

                @else if (item.isValueOnly) {
                <!-- Value-only row (for long values like exterior colors) -->
                <tr>
                    <td colspan="4">
                        {{ item.value }}
                    </td>
                </tr>
                }

                @else {
                <!-- Regular key-value pair -->
                <tr>
                    <td class="spec-label text-muted" style="width: 25%;">{{ item.key }}</td>
                    <td style="width: 25%;">{{ item.value }}</td>
                    <!-- Empty cells to ensure equal column width -->
                    @if (displayItems[$index + 1] && !displayItems[$index + 1].isHeader) {
                        <td class="spec-label text-muted" style="width: 25%;">{{ displayItems[$index + 1].key }}</td>
                        <td style="width: 25%;">{{ displayItems[$index + 1].value }}</td>
                    }
                </tr>
                }
                }
            </tbody>
        </table>
        }
    </ng-template>

    <ng-template #abpFooter>
        <button type="button" class="btn btn-outline-secondary px-3" (click)="close()">
            {{ '::Close' | abpLocalization }}
        </button>
    </ng-template>
</abp-modal>