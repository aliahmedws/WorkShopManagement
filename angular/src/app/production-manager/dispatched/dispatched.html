<div class="card">
    <div class="card-body">
        <ngx-datatable [rows]="cars.items" [count]="cars.totalCount" [list]="list" [columnMode]="'force'" default>
            <ngx-datatable-column [sortable]="false" [canAutoResize]="false" [width]="50">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <app-production-actions
                        [stage]="row"
                        [showDispatched]="false"
                        [showAssignBay]="false"
                        [showBayDetails]="false"
                        (change)="list?.get()"
                    ></app-production-actions>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Vin' | abpLocalization" prop="vin" [canAutoResize]="false" [width]="150">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class=" align-items-center d-flex">
                        <a type="button" class="text-primary text-decoration-underline" style="cursor: pointer;"
                            (click)="openCheckInModal(row)">
                            <strong>{{ value | slice:-6 }}</strong>
                        </a>
                        <a class="btn btn-link" [href]="'https://tracking.ausev.com.au/stock?q=' + row.vin"
                            target="_blank">
                            <i class="fas fa-book"></i>
                        </a>
                    </div>

                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Owner' | abpLocalization" prop="ownerName" [canAutoResize]="false" [width]="200"></ngx-datatable-column>

            <!-- <ngx-datatable-column [name]="'::ModelYear' | abpLocalization"
                        prop="modelYear"></ngx-datatable-column> -->
            <ngx-datatable-column [name]="'::Model' | abpLocalization" prop="modelName"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Color' | abpLocalization" prop="color" [canAutoResize]="false" [width]="200"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::EtaScd' | abpLocalization" prop="etaScd" [canAutoResize]="false" [width]="120">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Status' | abpLocalization" prop="locationStatus" [canAutoResize]="false" [width]="120"></ngx-datatable-column>

             <ngx-datatable-column
                [name]="'::AVV' | abpLocalization"
                prop="avvStatus" [canAutoResize]="false" [width]="150"
                [sortable]="false"
                >
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="d-flex align-items-center gap-2">
                    <span>
                        <ng-container *ngIf="row?.avvStatus !== null && row?.avvStatus !== undefined; else dash">
                        {{ ("::Enum:AvvStatus." + row.avvStatus) | abpLocalization }}
                        </ng-container>
                        <ng-template #dash>-</ng-template>
                    </span>

                    <button
                        type="button"
                        class="btn btn-sm btn-link p-0"
                        (click)="openAvvModal(row)"
                        [title]="'::AVV' | abpLocalization"
                    >
                        <i class="fas fa-pen"></i>
                    </button>
                    </div>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [canAutoResize]="false" [width]="80" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center">
                        <i class="fas fa-bullhorn link" (click)="openRecallModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::StorageLocation' | abpLocalization" prop="storageLocation" [canAutoResize]="false" [width]="120">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <ng-container
                        *ngIf="row?.storageLocation !== null && row?.storageLocation !== undefined; else dash">
                        {{ ("::Enum:StorageLocation." + row.storageLocation) | abpLocalization }}
                    </ng-container>

                    <ng-template #dash>-</ng-template>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Accessories' | abpLocalization" [canAutoResize]="false" [width]="100"
                [sortable]="false"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Est. Release' | abpLocalization" prop="deliverDate">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class="d-flex align-items-center gap-2">
                    <span>{{ value | date:'shortDate' }}</span>

                    <button
                        type="button"
                        class="btn btn-sm btn-link p-0"
                        (click)="openEstReleaseModal(row)"
                        [title]="'::EstimatedRelease' | abpLocalization">
                        <i class="fas fa-calendar-alt"></i>
                    </button>
                    </div>
                </ng-template>
            </ngx-datatable-column>

            <!-- <ngx-datatable-column [name]="'::BookingNumber' | abpLocalization" prop="bookingNumber"
                [maxWidth]="150"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::ClearingAgent' | abpLocalization" prop="clearingAgent"
                [maxWidth]="150"></ngx-datatable-column> -->

            <ngx-datatable-column [name]="'::Modified' | abpLocalization" prop="lastModificationTime" [canAutoResize]="false" [width]="100">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>

    </div>
</div>



<app-avv-status-modal [(visible)]="isAvvModalVisible" [carId]="selectedCar?.id" [currentStatus]="selectedCar?.avvStatus"(statusUpdated)="list.get()"></app-avv-status-modal>
<app-est-release-modal #estReleaseModal (saved)="onEstReleaseSaved($event)"></app-est-release-modal>
<!-- <app-recalls [(visible)]="isRecallModalVisible" [car]="selectedCar" (submit)="list?.get()" /> -->
<!-- <app-check-in-report-modal [(visible)]="isCheckInModalVisible" [car]="selectedCar" (submit)="list?.get()">
    </app-check-in-report-modal> -->
