<div class="card">
    <div class="card-body">
        <ngx-datatable [rows]="cars.items" [count]="cars.totalCount" [list]="list" default>
            <ngx-datatable-column [sortable]="false" [maxWidth]="50">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <app-production-actions [stage]="row" (change)="list?.get()"></app-production-actions>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Vin' | abpLocalization" prop="vin">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class="align-items-center d-flex">
                        <a type="button" class="text-primary clickable" (click)="openCheckInModal(row)">
                            <strong>{{ value | slice:-6 }}</strong>
                        </a>
                        <small>
                            <a class="ms-1" [href]="'https://tracking.ausev.com.au/stock?q=' + row.vin" target="_blank">
                                <i class="fas fa-external-link"></i>
                            </a>
                        </small>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Owner' | abpLocalization" prop="ownerName"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Model' | abpLocalization" prop="modelName"[minWidth]="350">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span abpEllipsis>{{ row.modelName }}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Color' | abpLocalization" prop="color">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span>{{ row.color | uppercase }}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::EtaScd' | abpLocalization" prop="etaScd">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Port' | abpLocalization" prop="car.logisticsDetails.port"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [maxWidth]="65" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center">
                        <i class="fas fa-bullhorn link" (click)="openRecallModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Notes' | abpLocalization" [maxWidth]="65" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center">
                        <i class="fas fa-message link" (click)="openNotesModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <!-- <ngx-datatable-column [name]="'::Accessories' | abpLocalization" [maxWidth]="100"
                [sortable]="false"></ngx-datatable-column> -->
            <ngx-datatable-column [name]="'::Est. Release' | abpLocalization" prop="deliverDate">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::BookingNumber' | abpLocalization" prop="bookingNumber"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::ClearingAgent' | abpLocalization" prop="clearingAgent"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Modified' | abpLocalization" prop="lastModificationTime">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>

    </div>
    <app-recalls [(visible)]="isRecallModalVisible" [car]="selectedCar" (submit)="list?.get()" />

    <app-check-in-report-modal [(visible)]="isCheckInModalVisible" [car]="selectedCar" (submit)="list?.get()">
    </app-check-in-report-modal>
</div>

<abp-modal [(visible)]="isNotesModalVisible" [options]="{ size: 'lg' }">
    <ng-template #abpHeader>
        {{ '::Notes' | abpLocalization }}
    </ng-template>

    <ng-template #abpBody>
        <form *ngIf="notesForm" [formGroup]="notesForm">
            <textarea class="form-control" rows="8" formControlName="notes"></textarea>
        </form>
    </ng-template>

    <ng-template #abpFooter>
        <button type="button" class="btn btn-primary" [disabled]="!notesForm" (click)="saveNotes()">
            <i class="fas fa-save me-1"></i>
            {{ '::Save' | abpLocalization }}
        </button>
    </ng-template>
</abp-modal>