<div class="card">
    <div class="card-header">
        <div class="card-title align-items-center d-flex justify-content-center">
            {{ '::IncomingCars' | abpLocalization }}
        </div>
    </div>
    <div class="card-body">
        <ngx-datatable [rows]="cars.items" [count]="cars.totalCount" [list]="list" default>
             <ngx-datatable-column [sortable]="false" [maxWidth]="50">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                            <div ngbDropdown container="body" class="d-inline-block">
                                <button class="ngx-actions-btn" data-toggle="dropdown" aria-haspopup="true"
                                    ngbDropdownToggle>
                                    <i class="fa-solid fa-ellipsis-vertical"></i>
                                </button>
                                <div ngbDropdownMenu>
                                    <button *abpPermission="'WorkShopManagement.Cars.Edit'" ngbDropdownItem
                                        (click)="edit(row.id)">
                                        {{ '::Edit' | abpLocalization }}
                                    </button>
                                    <button ngbDropdownItem (click)="showImages(row)">
                                        {{ '::Images' | abpLocalization }}
                                    </button>

                                    <button *abpPermission="'WorkShopManagement.LogisticsDetails'" ngbDropdownItem
                                        (click)="manageLogistics(row.id, row.vin)">
                                        {{ '::Logistics' | abpLocalization }}
                                    </button>
                                    <button *abpPermission="'WorkShopManagement.Issues'" ngbDropdownItem
                                        (click)="showIssues(row)">
                                        {{ '::Issues' | abpLocalization }}
                                    </button>

                                    <button *abpPermission="'WorkShopManagement.Cars.Delete'" ngbDropdownItem
                                        (click)="delete(row.id)">
                                        {{ '::Delete' | abpLocalization }}
                                    </button>
                                </div>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Vin' | abpLocalization" prop="vin" [maxWidth]="150">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class=" align-items-center d-flex">
                        <a type="button" class="text-primary text-decoration-underline" style="cursor: pointer;"
                            (click)="openCheckInModal(row)">
                            <strong>{{ value | slice:-6 }}</strong>
                        </a>
                        <a class="btn btn-link" [href]="'https://tracking.ausev.com.au/stock?q=' + row.vin"
                            target="_blank">
                            <i class="fas fa-book"></i>
                        </a>
                    </div>

                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Owner' | abpLocalization" prop="ownerName"
                [maxWidth]="150"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Model' | abpLocalization" prop="modelName"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Color' | abpLocalization" prop="color"
                [maxWidth]="150"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::EtaScd' | abpLocalization" prop="etaScd" [maxWidth]="120">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Status' | abpLocalization" prop="locationStatus"
                [maxWidth]="120"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [maxWidth]="80" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="badge bg-danger" (click)="openRecallModal(row)" style="cursor: pointer;">{{ '::R' |
                        abpLocalization }}</span>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column
                [name]="'::Notes' | abpLocalization"
                [maxWidth]="90"
                [sortable]="false"
                >
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <button
                    type="button"
                    class="btn btn-sm btn-link p-0 d-inline-flex align-items-center"
                    (click)="openNotesModal(row)"
                    [title]="'::Notes' | abpLocalization"
                    >
                    <i
                        class="fas fa-sticky-note"
                        [class.text-primary]="!!row.notes"
                        [class.text-muted]="!row.notes"
                        style="font-size: 1.1rem;"
                    ></i>
                    </button>
                </ng-template>
                </ngx-datatable-column>

            <ngx-datatable-column [name]="'::Accessories' | abpLocalization" [maxWidth]="100"
                [sortable]="false"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Est. Release' | abpLocalization" prop="deliverDate" [maxWidth]="120">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::BookingNumber' | abpLocalization" prop="bookingNumber"
                [maxWidth]="150"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::ClearingAgent' | abpLocalization" prop="clearingAgent"
                [maxWidth]="150"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Modified' | abpLocalization" prop="lastModificationTime" [maxWidth]="100">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>

    </div>
    <app-recalls [(visible)]="isRecallModalVisible" [car]="selectedCar" (submit)="list?.get()" />
    <app-car-notes-modal #notesModal (saved)="onNotesSaved($event)"></app-car-notes-modal>
    <app-check-in-report-modal [(visible)]="isCheckInModalVisible" [car]="selectedCar" (submit)="list?.get()">
    </app-check-in-report-modal>
    <app-car-images-modal [(visible)]="isImageModalVisible" [car]="selectedCar" (submit)="list?.get()"/>
    <app-car-create-edit-modal [(visible)]="isEditModalVisible" [carId]="selectedCarId" (submit)="list?.get()"/>
    <app-issue-modal [(visible)]="isIssueModalVisible" [carId]="selectedCarId"></app-issue-modal>

</div>
