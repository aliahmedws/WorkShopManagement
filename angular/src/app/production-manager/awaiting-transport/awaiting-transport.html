<div class="card">
    <div class="card-body">
        <ngx-datatable [rows]="cars.items" [count]="cars.totalCount" [list]="list" default>
            <!-- <ngx-datatable-column [sortable]="false" [maxWidth]="50">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                            <div ngbDropdown container="body" class="d-inline-block">
                                <button class="ngx-actions-btn" data-toggle="dropdown" aria-haspopup="true"
                                    ngbDropdownToggle>
                                    <i class="fa-solid fa-ellipsis-vertical"></i>
                                </button>
                                <div ngbDropdownMenu>
                                    <button *abpPermission="'WorkShopManagement.Cars.Edit'" ngbDropdownItem
                                        (click)="edit(row.id)">
                                        {{ '::Edit' | abpLocalization }}
                                    </button>
                                    <button *abpPermission="'WorkShopManagement.Cars.Delete'" ngbDropdownItem
                                        (click)="delete(row.id)">
                                        {{ '::Delete' | abpLocalization }}
                                    </button>
                                </div>
                            </div>
                        </ng-template>
                    </ngx-datatable-column> -->
            <ngx-datatable-column [name]="'::Actions' | abpLocalization" [maxWidth]="140" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <button type="button" class="btn btn-sm btn-outline-primary" (click)="dispatched(row.id)">
                        {{ '::Dispatched' | abpLocalization }}
                    </button>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Vin' | abpLocalization" prop="vin" [maxWidth]="150">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class=" align-items-center d-flex">
                        <a type="button" class="text-primary text-decoration-underline" style="cursor: pointer;"
                            (click)="openCheckInModal(row)">
                            <strong>{{ value | slice:-6 }}</strong>
                        </a>
                        <a class="btn btn-link" [href]="'https://tracking.ausev.com.au/stock?q=' + row.vin"
                            target="_blank">
                            <i class="fas fa-book"></i>
                        </a>
                    </div>

                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Owner' | abpLocalization" prop="ownerName"
                [maxWidth]="150"></ngx-datatable-column>

            <!-- <ngx-datatable-column [name]="'::ModelYear' | abpLocalization"
                        prop="modelYear"></ngx-datatable-column> -->
            <ngx-datatable-column [name]="'::Model' | abpLocalization" prop="modelName"
                [maxWidth]="550"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Color' | abpLocalization" prop="color"
                [maxWidth]="150"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::EtaScd' | abpLocalization" prop="etaScd" [maxWidth]="120">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <!-- <ngx-datatable-column [name]="'::Status' | abpLocalization" prop="locationStatus"
                [maxWidth]="120"></ngx-datatable-column> -->

            <ngx-datatable-column [name]="'::AVV' | abpLocalization" prop="avvStatus" [maxWidth]="120">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <button type="button" class="btn btn-link p-0" (click)="openAvvModal(row)" style="cursor: pointer;">
                        <ng-container *ngIf="row?.avvStatus !== null && row?.avvStatus !== undefined; else dash">
                            {{ ("::Enum:AvvStatus." + row.avvStatus) | abpLocalization }}
                        </ng-container>

                        <ng-template #dash>-</ng-template>
                    </button>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [maxWidth]="80" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="badge bg-danger" (click)="openRecallModal(row)" style="cursor: pointer;">{{ '::R' |
                        abpLocalization }}</span>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::StorageLocation' | abpLocalization" prop="storageLocation"
                [maxWidth]="120">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <ng-container
                        *ngIf="row?.storageLocation !== null && row?.storageLocation !== undefined; else dash">
                        {{ ("::Enum:StorageLocation." + row.storageLocation) | abpLocalization }}
                    </ng-container>

                    <ng-template #dash>-</ng-template>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Accessories' | abpLocalization" [maxWidth]="100"
                [sortable]="false"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Est. Release' | abpLocalization" prop="deliverDate" [maxWidth]="120">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <button type="button" class="btn btn-link p-0" (click)="openEstReleaseModal(row)">
                        <span class="text-decoration-underline">
                            {{ value ? (value | date:'shortDate') : '-' }}
                        </span>
                    </button>
                </ng-template>
            </ngx-datatable-column>
            <!-- <ngx-datatable-column [name]="'::BookingNumber' | abpLocalization" prop="bookingNumber"
                [maxWidth]="150"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::ClearingAgent' | abpLocalization" prop="clearingAgent"
                [maxWidth]="150"></ngx-datatable-column> -->

            <ngx-datatable-column [name]="'::Modified' | abpLocalization" prop="lastModificationTime" [maxWidth]="100">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>

    </div>
</div>

<abp-modal [(visible)]="isEstReleaseModalVisible" [options]="{ size: 'md' }">
    <ng-template #abpHeader>
        {{ '::EstimatedRelease' | abpLocalization }}
    </ng-template>

    <ng-template #abpBody>
        <form *ngIf="estReleaseForm" [formGroup]="estReleaseForm" class="row g-3">
            <div class="col-12">
                <input type="date" class="form-control" formControlName="estimatedReleaseDate" />
            </div>
        </form>
    </ng-template>

    <ng-template #abpFooter>
        <button type="button" class="btn btn-primary" [disabled]="!estReleaseForm" (click)="saveEstRelease()">
            <i class="fas fa-save me-1"></i>
            {{ '::Save' | abpLocalization }}
        </button>
    </ng-template>
</abp-modal>

<app-recalls [(visible)]="isRecallModalVisible" [car]="selectedCar" (submit)="list?.get()" />
<app-check-in-report-modal [(visible)]="isCheckInModalVisible" [car]="selectedCar" (submit)="list?.get()">
</app-check-in-report-modal>
<app-avv-status-modal [(visible)]="isAvvModalVisible" [carId]="selectedCar?.id" [currentStatus]="selectedCar?.avvStatus"
    (statusUpdated)="list.get()">
</app-avv-status-modal>