<div class="card">
    <div class="card-body">
        <ngx-datatable [rows]="stages.items" [count]="stages.totalCount" [list]="list" default>
            <ngx-datatable-column [sortable]="false" [maxWidth]="50">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <app-production-actions [stage]="row" [showBayDetails]="true"
                        (change)="list?.get()"></app-production-actions>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Vin' | abpLocalization" prop="vin" [maxWidth]="150">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class="align-items-center d-flex">
                        <a type="button" class="text-primary clickable" (click)="openCheckInModal(row)">
                            <strong>{{ value | slice:-6 }}</strong>
                        </a>
                        <small>
                            <a class="ms-1" [href]="'https://tracking.ausev.com.au/stock?q=' + row.vin" target="_blank">
                                <i class="fas fa-external-link"></i>
                            </a>
                        </small>
                    </div>

                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Owner' | abpLocalization" prop="ownerName" [maxWidth]="150">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    {{ row.ownerName | uppercase }}
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::Model' | abpLocalization" prop="modelName"
                [maxWidth]="550"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Color' | abpLocalization" prop="color" [maxWidth]="150">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    {{ row.color | uppercase }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::AVV' | abpLocalization" prop="avvStatus" [maxWidth]="140"
                [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center badge bg-{{mapAvvStatus(row)}} link" (click)="openAvvModal(row)">
                        {{ row?.avvStatus ? (("::Enum:AvvStatus." + row.avvStatus) | abpLocalization) : 'AVV' }}
                    </div>
                </ng-template>
            </ngx-datatable-column>


            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [maxWidth]="65" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center text-{{getRecallColor(row)}}">
                        <i class="fas fa-bullhorn link" (click)="openRecallModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Est. Release' | abpLocalization" prop="estimatedRelease" [sortable]="false"
                [maxWidth]="100">
                <ng-template let-row="row" ngx-datatable-cell-template>

                    <div class="text-center text-{{getEstRelease(row)}}">
                        <i class="fas fa-calendar-alt link" (click)="openEstReleaseModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>

    </div>
</div>


<!-- MODALS -->

<app-avv-status-modal [(visible)]="isAvvModalVisible" [carId]="selected?.carId" [currentStatus]="selected?.avvStatus"
    (statusUpdated)="list.get()"></app-avv-status-modal>
<app-est-release-modal #estReleaseModal (saved)="list.get()"></app-est-release-modal>
<app-recalls [(visible)]="isRecallModalVisible" [carId]="selected?.carId" (submit)="list?.get()" />