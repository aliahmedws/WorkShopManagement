<div class="card">
    <div class="card-header">
        <div class="card-title align-items-center d-flex justify-content-center">
            {{ '::Post-Production' | abpLocalization }}
        </div>
    </div>
    <div class="card-body">
        <ngx-datatable [rows]="cars.items" [count]="cars.totalCount" [list]="list" default>
            <!-- <ngx-datatable-column [sortable]="false" [maxWidth]="50">
                        <ng-template let-row="row" ngx-datatable-cell-template>
                            <div ngbDropdown container="body" class="d-inline-block">
                                <button class="ngx-actions-btn" data-toggle="dropdown" aria-haspopup="true"
                                    ngbDropdownToggle>
                                    <i class="fa-solid fa-ellipsis-vertical"></i>
                                </button>
                                <div ngbDropdownMenu>
                                    <button *abpPermission="'WorkShopManagement.Cars.Edit'" ngbDropdownItem
                                        (click)="edit(row.id)">
                                        {{ '::Edit' | abpLocalization }}
                                    </button>
                                    <button *abpPermission="'WorkShopManagement.Cars.Delete'" ngbDropdownItem
                                        (click)="delete(row.id)">
                                        {{ '::Delete' | abpLocalization }}
                                    </button>
                                </div>
                            </div>
                        </ng-template>
                    </ngx-datatable-column> -->
            <!-- <ngx-datatable-column [name]="'::Actions' | abpLocalization" [maxWidth]="140" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <button type="button" class="btn btn-sm btn-outline-primary" (click)="openAssignModal(row.id)">
                        {{ '::AssignToBay' | abpLocalization }}
                    </button>
                </ng-template>
            </ngx-datatable-column> -->
            <ngx-datatable-column [name]="'::Vin' | abpLocalization" prop="vin" [maxWidth]="150">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class=" align-items-center d-flex">
                        <a type="button" class="text-primary text-decoration-underline" style="cursor: pointer;"
                            (click)="openCheckInModal(row)">
                            <strong>{{ value | slice:-6 }}</strong>
                        </a>
                        <a class="btn btn-link" [href]="'https://tracking.ausev.com.au/stock?q=' + row.vin"
                            target="_blank">
                            <i class="fas fa-book"></i>
                        </a>
                    </div>

                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Bay' | abpLocalization" prop="bayName" [maxWidth]="150">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <a
                    class="text-primary text-decoration-underline"
                    style="cursor: pointer"
                    (click)="openProductionDetails(row)"
                    >
                    {{ value || '-' }}
                    </a>
                </ng-template>
                </ngx-datatable-column>

            <ngx-datatable-column [name]="'::Owner' | abpLocalization" prop="ownerName"
                [maxWidth]="150"></ngx-datatable-column>

            <!-- <ngx-datatable-column [name]="'::ModelYear' | abpLocalization"
                        prop="modelYear"></ngx-datatable-column> -->
            <ngx-datatable-column [name]="'::Model' | abpLocalization" prop="modelName"
                [maxWidth]="550"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Color' | abpLocalization" prop="color"
                [maxWidth]="150"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::EtaScd' | abpLocalization" prop="etaScd" [maxWidth]="120">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Status' | abpLocalization" prop="locationStatus"
                [maxWidth]="120"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [maxWidth]="80" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <span class="badge bg-danger" (click)="openRecallModal(row)" style="cursor: pointer;">{{ '::R' |
                        abpLocalization }}</span>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::StorageLocation' | abpLocalization" prop="storageLocation"
                [maxWidth]="120">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <ng-container
                        *ngIf="row?.storageLocation !== null && row?.storageLocation !== undefined; else dash">
                        {{ ("::Enum:StorageLocation." + row.storageLocation) | abpLocalization }}
                    </ng-container>

                    <ng-template #dash>-</ng-template>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [maxWidth]="80"
                [sortable]="false"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Accessories' | abpLocalization" [maxWidth]="100"
                [sortable]="false"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::Est. Release' | abpLocalization" prop="deliverDate" [maxWidth]="120">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::BookingNumber' | abpLocalization" prop="bookingNumber"
                [maxWidth]="150"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::ClearingAgent' | abpLocalization" prop="clearingAgent"
                [maxWidth]="150"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Modified' | abpLocalization" prop="lastModificationTime" [maxWidth]="100">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
        </ngx-datatable>

    </div>
</div>
<abp-modal [(visible)]="isAssignModalVisible" [options]="{ size: 'md' }">
    <ng-template #abpHeader>
        {{ '::AssignToBay' | abpLocalization }}
    </ng-template>

    <ng-template #abpBody>
        <form *ngIf="form" [formGroup]="form" class="row g-3">

            <!-- Manufacture Start Date -->
            <div class="col-12 col-md-6">
                <label class="form-label fw-semibold">
                    {{ '::ManufactureStartDate' | abpLocalization }}
                </label>

                <input type="date" class="form-control" formControlName="manufactureStartDate" />

                <div class="text-danger small mt-1"
                    *ngIf="form.get('manufactureStartDate')?.touched && form.get('manufactureStartDate')?.invalid">
                    {{ '::Required' | abpLocalization }}
                </div>
            </div>

            <!-- Bay -->
            <div class="col-12 col-md-6">
                <label class="form-label fw-semibold">
                    {{ '::BayNumber' | abpLocalization }}
                </label>

                <nz-select nzShowSearch nzAllowClear nzSize="large" class="w-100" formControlName="bayId"
                    [nzPlaceHolder]="'::Select' | abpLocalization">
                    <nz-option *ngFor="let option of bayOptions" [nzLabel]="option.displayName"
                        [nzValue]="option.id"></nz-option>
                </nz-select>

                <div class="text-danger small mt-1" *ngIf="form.get('bayId')?.touched && form.get('bayId')?.invalid">
                    {{ '::Required' | abpLocalization }}
                </div>
            </div>

            <!-- Priority -->
            <div class="col-12 col-md-6">
                <label class="form-label fw-semibold">
                    {{ '::Priority' | abpLocalization }}
                </label>

                <nz-select nzAllowClear nzSize="large" class="w-100" formControlName="priority"
                    [nzPlaceHolder]="'::Select' | abpLocalization">
                    <nz-option [nzLabel]="('::Enum:Priority.1' | abpLocalization)" [nzValue]="priority.Low"></nz-option>
                    <nz-option [nzLabel]="('::Enum:Priority.2' | abpLocalization)"
                        [nzValue]="priority.Medium"></nz-option>
                    <nz-option [nzLabel]="('::Enum:Priority.3' | abpLocalization)"
                        [nzValue]="priority.High"></nz-option>
                    <nz-option [nzLabel]="('::Enum:Priority.4' | abpLocalization)"
                        [nzValue]="priority.Critical"></nz-option>
                </nz-select>

                <div class="text-danger small mt-1"
                    *ngIf="form.get('priority')?.touched && form.get('priority')?.invalid">
                    {{ '::Required' | abpLocalization }}
                </div>
            </div>

        </form>
    </ng-template>

    <ng-template #abpFooter>
        <button type="button" class="btn btn-outline-secondary" (click)="closeAssignModal()">
            {{ '::Cancel' | abpLocalization }}
        </button>

        <button type="button" class="btn btn-primary" [disabled]="!form || form.invalid" (click)="assignToBay()">
            {{ '::AssignToBay' | abpLocalization }}
        </button>
    </ng-template>

    <app-recalls [(visible)]="isRecallModalVisible" [car]="selectedCar" (submit)="list?.get()" />

    <app-check-in-report-modal [(visible)]="isCheckInModalVisible" [car]="selectedCar" (submit)="list?.get()">
    </app-check-in-report-modal>
</abp-modal>


<app-production-details-modal #detailsModal (stageChanged)="onStageChanged($event)"></app-production-details-modal>
