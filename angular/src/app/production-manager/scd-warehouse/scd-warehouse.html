<div class="card">
    <div class="card-body">

        <ngx-datatable [rows]="stages.items" [count]="stages.totalCount" [list]="list" [columnMode]="'force'" default>
            <ngx-datatable-column [sortable]="false" [canAutoResize]="false" [width]="50">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <app-production-actions [stage]="row" [showAssignBay]="true" [showBayDetails]="true"
                        (change)="list?.get()"
                        [(isIssueModalVisible)]="issueModalVisible[row.carId]"></app-production-actions>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Vin' | abpLocalization" prop="vin" [canAutoResize]="false" [width]="150">
                <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
                    <div class="align-items-center d-flex">
                        <a type="button" class="text-primary clickable" (click)="openCheckInModal(row)">
                            <strong>{{ value | slice:-6 }}</strong>
                        </a>
                        <small>
                            <a class="ms-1" [href]="'https://tracking.ausev.com.au/stock?q=' + row.vin" target="_blank">
                                <i class="fas fa-external-link"></i>
                            </a>
                        </small>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Owner' | abpLocalization" prop="ownerName" [canAutoResize]="false"
                [width]="200">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | uppercase }}
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::Model' | abpLocalization" prop="modelName">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div abpEllipsis>{{ row.modelName }}</div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Color' | abpLocalization" prop="color" [canAutoResize]="false"
                [width]="150">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    <span>{{ value | uppercase }}</span>
                </ng-template>

            </ngx-datatable-column>

            <ngx-datatable-column [name]="'::StorageLocation' | abpLocalization" prop="storageLocation"
                [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    {{ row?.storageLocation ? ('::Enum:StorageLocation.' + row.storageLocation | abpLocalization) : '-'
                    }}
                </ng-template>
            </ngx-datatable-column>

            <!-- INCOMING / WAREHOUSE -->
            <ngx-datatable-column [name]="'::EtaScd' | abpLocalization" prop="etaScd" [sortable]="false">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column [name]="'::Port' | abpLocalization" prop="port" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    {{ row?.port ? ('::Enum:Port.' + row.port | abpLocalization) : '-' }}
                </ng-template>
            </ngx-datatable-column>

            <!-- INCOMING / WAREHOUSE -->

            <!-- ---------- ACTIONS GROUP  --------- -->
            <ngx-datatable-column [name]="'::Recalls' | abpLocalization" [canAutoResize]="false" [width]="65"
                [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center text-{{getRecallColor(row)}}">
                        <i class="fas fa-bullhorn link" (click)="openRecallModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column *abpPermission="'WorkShopManagement.Cars.Edit'" [name]="'::Notes' | abpLocalization" [canAutoResize]="false" [width]="65"
                [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center text-{{getNoteColor(row)}}">
                        <i class="fas fa-message link" (click)="openNotesModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column *abpPermission="'WorkShopManagement.Cars.Edit'" [name]="'::Est. Release' | abpLocalization" prop="estimatedRelease" [sortable]="false"
                [canAutoResize]="false" [width]="100">
                <ng-template let-row="row" ngx-datatable-cell-template>

                    <div class="text-center text-{{getEstRelease(row)}}">
                        <i class="fas fa-calendar-alt link" (click)="openEstReleaseModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column *abpPermission="'WorkShopManagement.Issues'" [name]="'::Issues' | abpLocalization" prop="issueStatus" [sortable]="false"
                [canAutoResize]="false" [width]="70">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="text-center text-primary">
                        <i class="fas fa-triangle-exclamation link" (click)="openIssueModal(row)"></i>
                    </div>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column *abpPermission="'WorkShopManagement.QualityGates.Edit'" [name]="'::QualityGates' | abpLocalization" [sortable]="false" [canAutoResize]="false"
                [width]="100">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <ng-container *ngIf="row?.carBayId; else noBay">
                        <div class="text-center text-primary">
                            <i class="fas fa-clipboard-check link" title="Quality Gates"
                                (click)="openQualityGates(row)"></i>
                        </div>
                    </ng-container>

                    <ng-template #noBay>
                        <div class="text-center text-secondary">
                            <i class="fas fa-clipboard-check opacity-25" title="No Bay"></i>
                        </div>
                    </ng-template>
                </ng-template>
            </ngx-datatable-column>
            <ngx-datatable-column *abpPermission="'WorkShopManagement.LogisticsDetails'" [name]="'::CRE' | abpLocalization" prop="creStatus" [sortable]="false">
                <ng-template let-row="row" ngx-datatable-cell-template>
                    <div class="badge bg-{{getCreStatusColor(row)}} link" (click)="openCreDetailModal(row)">
                        {{ row?.creStatus ? ('::Enum:CreStatus.' + row.creStatus | abpLocalization) : 'CRE' }}
                    </div>
                </ng-template>
            </ngx-datatable-column>

            <!-- ---------- ACTIONS GROUP END --------- -->

            <!-- -----INCOMING / WAREHOUSE----- -->
            <ngx-datatable-column [name]="'::BookingNumber' | abpLocalization" [sortable]="false"
                prop="bookingNumber"></ngx-datatable-column>
            <ngx-datatable-column [name]="'::ClearingAgent' | abpLocalization" [sortable]="false"
                prop="clearingAgent"></ngx-datatable-column>

            <ngx-datatable-column [name]="'::Modified' | abpLocalization" prop="lastModificationTime"
                [canAutoResize]="false" [width]="100">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date:'shortDate' }}
                </ng-template>
            </ngx-datatable-column>

            <!-- ----- INCOMING / WAREHOUSE----- -->
        </ngx-datatable>

    </div>
</div>

<!-- MODALS -->
<app-recalls [(visible)]="isRecallModalVisible" [vin]="selected?.vin" [carId]="selected?.carId" (submit)="list?.get()" />
<app-cre-detail-modal [(visible)]="isCreDetailModalVisible" [carId]="selected.carId" [vin]="selected.vin" (submit)="list?.get()" />
<app-check-in-report-modal [(visible)]="isCheckInModalVisible" [carId]="selected.carId" [carVin]="selected.vin"
    (submit)="list?.get()"></app-check-in-report-modal>
<app-est-release-modal #estReleaseModal (saved)="list?.get()"></app-est-release-modal>
<app-car-notes-modal #notesModal (saved)="list?.get()"></app-car-notes-modal>
<app-quality-gates-modal [(visible)]="isQualityGatesModalVisible" [carId]="selected.carId" [vin]="selected.vin" (saved)="list?.get()"></app-quality-gates-modal>
<!-- MODALS END  -->