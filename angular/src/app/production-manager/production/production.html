
    <div class="card-body">
        <div class="row g-3">
            @for (bay of activeCarBays; track bay.bayId) {
            <div class="col-12 col-md-6 col-xl-3">

                <!-- Bay title -->
                <div class="bay-title text-center mb-2">
                    {{ bay.bayName }}
                </div>

                <!-- get assignment -->
                <!-- @let a = getAssignment(bay.id); -->

                <div class="bay-box" [class.bay-box--assigned]="!!bay.carId" role="button" tabindex="0"
                    (click)="onOpenBay(bay)">

                    <!-- Unassigned -->
                    <ng-container *ngIf="!bay.carId; else assignedTpl">
                        <div class="bay-box__center text-muted fw-semibold">
                            {{ '::Unassigned' | abpLocalization }}
                        </div>
                    </ng-container>

                    <!-- Assigned -->
                    <ng-template #assignedTpl>
                        <div class="bay-card p-2">

                            <!-- top row -->
                            <div class="d-flex align-items-start justify-content-between">
                                <div class="fw-bold">
                                    {{ vinLast6(bay.vin) }}
                                </div>

                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge text-bg-warning">
                                        {{'::Enum:Priority.' + bay.priority | abpLocalization}}
                                    </span>

                                    <button type="button" class="btn btn-sm btn-link text-danger p-0 bay-clear"
                                        *ngIf="bay.bayId" (click)="onDeleteClick(bay, $event)" aria-label="Clear bay"
                                        title="Clear bay">
                                        âœ•
                                    </button>

                                </div>
                            </div>

                            <div class="d-flex justify-content-center my-2">
                                <img *ngIf="bay.imageUrl; else noImg" nz-image width="160" height="95"
                                    [nzSrc]="bay.imageUrl" [alt]="bay.modelName || 'model'"
                                    style="object-fit: cover; border-radius: 2px; pointer-events: none;" />

                                <ng-template #noImg>
                                    <div class="text-muted small">-</div>
                                </ng-template>
                            </div>


                            <!-- center text -->
                            <div class="d-flex align-items-end justify-content-between">
                                <div>
                                    <div class="small fw-bold">
                                        {{ bay.ownerName ?? '-' | uppercase }}
                                    </div>

                                    <div class="small fw-bold">
                                        {{ bay.modelName ?? '-' }}
                                    </div>

                                    <div class="small fw-bold">
                                        {{ '::ManufactureStartDate' | abpLocalization }}:
                                        <span *ngIf="bay.manufactureStartDate; else dashDate">
                                            {{ bay.manufactureStartDate | date:'dd/MMM/yyyy' }}
                                        </span>
                                        <ng-template #dashDate>-</ng-template>
                                    </div>

                                    <!-- <div class="small fw-bold">
                                    {{ a?.modelCategoryName ?? '-' }}
                                </div> -->
                                </div>
                                <div>
                                    <div class="text-{{getRecallColor(bay)}} fs-4">
                                        <i class="fas fa-bullhorn"></i>
                                    </div>
                                    <div class="text-{{getIssueColor(bay)}} fs-4">
                                        <i class="fas fa-triangle-exclamation"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </div>
            </div>
            }

        </div>
    </div>


<!-- your grid / bay cards html stays the same -->
<app-production-details-modal [(visible)]="isProductionDetailVisible"  [carId]="carId"  (stageChanged)="onStageChanged()" (closed)="onDetailsClosed()"></app-production-details-modal>
<!-- <app-production-details-modal #detailsModal (stageChanged)="onStageChanged($event)" (closed)="onDetailsClosed()"></app-production-details-modal> -->